1 FROM mcr.microsoft.com/dotnet/core/aspnet:3.1 AS base # IMAGE AS BASE SMALL
2 WORKDIR /app # CREATE THE DIRECTORY PATH
3 EXPOSE 80 # PORT
4
5 FROM mcr.microsoft.com/dotnet/core/sdk:3.1 AS build # IMAGE AS BUILD (BIGGER)
6 WORKDIR /src # CREATE src FOLDER
7 COPY src/Services/Catalog/Catalog.API/Catalog.API.csproj … # COPY THE FILES FORM THE PROJECT
8 COPY src/BuildingBlocks/HealthChecks/src/Microsoft.AspNetCore.HealthChecks …
9 COPY src/BuildingBlocks/HealthChecks/src/Microsoft.Extensions.HealthChecks …
10 COPY src/BuildingBlocks/EventBus/IntegrationEventLogEF/ …
11 COPY src/BuildingBlocks/EventBus/EventBus/EventBus.csproj …
12 COPY src/BuildingBlocks/EventBus/EventBusRabbitMQ/EventBusRabbitMQ.csproj …
13 COPY src/BuildingBlocks/EventBus/EventBusServiceBus/EventBusServiceBus.csproj …
14 COPY src/BuildingBlocks/WebHostCustomization/WebHost.Customization …
15 COPY src/BuildingBlocks/HealthChecks/src/Microsoft.Extensions …
16 COPY src/BuildingBlocks/HealthChecks/src/Microsoft.Extensions …
17 RUN dotnet restore src/Services/Catalog/Catalog.API/Catalog.API.csproj # RESTORE PACKAGES FROM CATALOG.API
18 COPY . . # COPY ALL EXCEPT THE FILES FROM dockerignore
19 WORKDIR /src/src/Services/Catalog/Catalog.API # CHANGE FOLDER
20 RUN dotnet build Catalog.API.csproj -c Release -o /app # BUILD THE PROJECT AND LOCATED AT /app FOLDER
21
22 FROM build AS publish # STATRT A PUBLISH 
23 RUN dotnet publish Catalog.API.csproj -c Release -o /app # PUBLISH THE PROJECT AND LOCATED AT /app FOLDER
24
25 FROM base AS final # FINAL 
26 WORKDIR /app # CHANGE FOLDER
27 COPY --from=publish /app . # COPY THE FINAL APP PUBLISH TO FOLDER 
28 ENTRYPOINT ["dotnet", "Catalog.API.dll"] # DEFINE THE STARTER COMMAND